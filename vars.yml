---
# Realms and domain settings
windows_realm: WIN.EXAMPLE.COM
windows_domain: win.example.com
ipaserver_realm: EXAMPLE.COM
ipaserver_domain: example.com
ipareplica_domain: example.com

# Server and replica related stuff
ipaadmin_principal: admin
ipaserver: ipa1.example.com
ipareplica_server_name: ipa2.example.com
ipaserver_setup_adtrust: true
ipareplica_setup_adtrust: true
ipareplica_setup_firewalld: false
ipareplica_install_packages: true
domain_prefix: linux

# CA related stuff
ipareplica_setup_ca: false
ipaserver_no_pkinit: true
ipareplica_no_pkinit: true
ipaserver_external_ca: false
ipaserver_dirsrv_cert_files: "/root/{{ ipaserver }}-key-and-crt.pem"
ipaserver_http_cert_files: "/root/{{ ipaserver }}-key-and-crt.pem"
ipareplica_dirsrv_cert_files: "/root/{{ ipareplica_server_name }}-key-and-crt.pem"
ipareplica_http_cert_files: "/root/{{ ipareplica_server_name }}-key-and-crt.pem"
external_ca_cert_file: /root/ca.crt

# DNS related stuff
ipaserver_setup_dns: true
ipareplica_setup_dns: true
ipaserver_forwarders: 1.1.1.1
ipareplica_forwarders: "{{ ipaserver_forwarders }}"
# Evil, but needed in the lab when using example.com for production usage
# remove this
ipaserver_allow_zone_overlap: true
ipaserver_no_dnssec_validation: true
ipareplica_no_dnssec_validation: true
dns_allow_query_cache_iprange: "10.0.0.0/8"

global_dns_resolvers:
  - 1.2.3.4
  - 1.2.3.5

windows_domain_dns_resolvers:
  - 1.2.3.6
  - 1.2.3.7

# Client related stuff
ipaclient_mkhomedir: true
ipaclient_no_ntp: true
ipaclient_ssh_trust_dns: true

# Mapping of hostnames and IP Addresses
sles_client:
  - name: sles15.example.com
    ip: 192.168.100.195
  - name: sles15sp2.example.com
    ip: 192.168.100.181

# User and group related stuff:
localgroups:
  - name: superusers
    user:
      - jbond
      - jdoe
  - name: webadmins
  - name: dbadmins

localadmins:
  - name: jbond
    first: James
    last: Bond
    password: changeit
  - name: jdoe
    first: John
    last: Doe
    password: changeit

# Mappings from AD Groups to IPA groups
usergroup_mappings:
  - name: ad-grp-webadmins
    description: Web Administrators
    ipagroup: webadmins
  - name: ad-grp-dbadmins
    description: Database Administrators
    ipagroup: dbadmins

# Hostgroups:
hostgroup_list:
  - name: dbserver
  - name: webserver

# HBAC rules:
hbacrule_list:
  - name: allow_all
    enabled: false
  - name: allow_webadmins_webservers
    description: Allow web administrators to login to webserver systems
    group: webadmins
    hostgroup: webserver
    enabled: true
  - name: allow_dbadmins_dbservers
    description: Allow databse administrators to login to database systems
    group: dbadmins
    hostgroup: dbserver
    enabled: true
  - name: allow_admins_ipaservers
    description: Allow members of admins group to login to IPA servers
    group: admins
    hostgroup: ipaservers
    enabled: true
  - name: allow_superusers_all
    description: Allow members of superusers group to login to all servers in IPA domain
    group: superusers
    hostcategory: "all"
    enabled: true

# Sudo related stuff:
sudocommandgroups:
  - name: webadmincommands
    description: Web adminstration commands
    command_list:
      - name: /usr/bin/systemctl stop httpd
        description: Stop HTTP Server
      - name: /usr/bin/systemctl start httpd
        description: Start HTTP Server
      - name: /usr/bin/systemctl restart httpd
        description: Restart HTTP Server
      - name: /usr/bin/systemctl stop apache2
        description: Stop HTTP Server on SLES
      - name: /usr/bin/systemctl start apache2
        description: Start HTTP Server on SLES
      - name: /usr/bin/systemctl restart apache2
        description: Restart HTTP Server on SLES
  - name: dbadmincommands
    description: Database adminstration commands
    command_list:
      - name: /usr/bin/systemctl stop postgresql
        description: Stop HTTP Server
      - name: /usr/bin/systemctl start postgresql
        description: Start HTTP Server
      - name: /usr/bin/systemctl restart postgresql
        description: Restart HTTP Server

sudorules:
  - name: webadminrule
    description: Allow web administrators to manage web servers
    usergroup: webadmins
    allow_sudocmdgroup: webadmincommands
  - name: dbadminrule
    description: Allow database administrators to manage database servers
    usergroup: dbadmins
    allow_sudocmdgroup: dbadmincommands
